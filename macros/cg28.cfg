[gcode_macro CG28]
description: Conditional G28 (home if not already homed)
gcode:
    {% if "x" not in printer.toolhead.homed_axes or "y" not in printer.toolhead.homed_axes or "z" not in printer.toolhead.homed_axes %}
        G28        
        M400
    {% endif %}