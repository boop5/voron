[gcode_macro PRINT_START]
gcode:
    {% set bed_temp = params.BED|default(100)|float %}
    {% set extruder_temp = params.EXTRUDER|default(220)|float %}
    {% set z_adjust = params.Z_ADJUST|default(0.0)|float %}
    {% set retract = 10 %}

    G21 # set units to millimeters
    G90 # use absolute coordinates
    M83 # use relative distances for extrusion

    BED_MESH_CLEAR                    ; clear mesh

    _CG28                              ; Home the printer
    G1 Z+20
    G0 X175 Y175 F12000          ; Move to center
    M117 Heating..
    M106 S255                         ; set print fan to full speed

    M140 S{bed_temp}                # Start bed heating
    M104 S{extruder_temp}           # Start nozzle heating
    M190 S{bed_temp}                # Wait for bed to reach temperature
    M109 S{extruder_temp}           # Set and wait for nozzle to reach temperature # "M109 is so extruder is up to temp before doing z calibrate so expansion is accounted for"

    M107                              ; turn print fan off
    QUAD_GANTRY_LEVEL PARK=false
    CLEAN_NOZZLE                      ; clean nozzle
    CALIBRATE_Z
    BED_MESH_PROFILE LOAD=hot3        ; load mesh if needed
    # Adjust the G-Code Z offset with the Z_ADJUST parameter if needed
    #SET_GCODE_OFFSET Z_ADJUST={z_adjust} MOVE=1
    M117 Intro Line..
    G90                               ; Use absolute coordinates
    G1 Y0 X130 Z5 F12000              ; Move the nozzle to the front and near the bed
    G1 Z0.7 F300                      ; Move the nozzle very close to the bed
    G92 E0.0                          ; set extruder position to 0
    G1 E{retract} F3600               ; extrude retract
    G92 E0.0                          ; set extruder option to 0
    G1 X180 E15.0 F500.0              ; intro line
    G92 E0.0                          ; set extruder Poisson to 0
    G1 X174 F6000                     ; move away from intro line
    M117